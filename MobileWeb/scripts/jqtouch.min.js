(function(a){a.jQTouch=function(E){a.support.WebKitCSSMatrix=typeof WebKitCSSMatrix=="object";a.support.touch=typeof Touch=="object";a.support.WebKitAnimationEvent=typeof WebKitTransitionEvent=="object";var i,F=a("head"),d=[],A=0,b={},I,e,j,H=RegExp(" Mobile/").test(navigator.userAgent),m=true,q=0,g=[],h={},u=a.jQTouch.prototype.extensions,p=["slide","flip","slideup","swap","cube","pop","dissolve","fade","back"],c=[],f="";G(E);function G(l){var j={addGlossToIcon:true,backSelector:".back, .cancel, .goback",cacheGetRequests:true,cubeSelector:".cube",dissolveSelector:".dissolve",fadeSelector:".fade",fixedViewport:true,flipSelector:".flip",formSelector:"form",fullScreen:true,fullScreenClass:"fullscreen",icon:null,touchSelector:"a, .touch",popSelector:".pop",preloadImages:false,slideSelector:"body > * > ul li a",slideupSelector:".slideup",startupScreen:null,statusBar:"default",submitSelector:".submit",swapSelector:".swap",useAnimations:true,useFastTouch:true};b=a.extend({},j,l);if(b.preloadImages)for(var c=b.preloadImages.length-1;c>=0;c--)(new Image).src=b.preloadImages[c];if(b.icon){var d=b.addGlossToIcon?"":"-precomposed";f+='<link rel="apple-touch-icon'+d+'" href="'+b.icon+'" />'}if(b.startupScreen)f+='<link rel="apple-touch-startup-image" href="'+b.startupScreen+'" />';if(b.fixedViewport)f+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=1"/>';if(b.fullScreen){f+='<meta name="apple-mobile-web-app-capable" content="yes" />';if(b.statusBar)f+='<meta name="apple-mobile-web-app-status-bar-style" content="'+b.statusBar+'" />'}f&&F.append(f);a(document).ready(function(){for(var j in u){var f=u[j];a.isFunction(f)&&a.extend(h,f(h))}for(var j in p){var d=p[j],c=b[d+"Selector"];typeof c=="string"&&t({name:d,selector:c})}g.push("input");g.push(b.touchSelector);g.push(b.backSelector);g.push(b.submitSelector);a(g.join(", ")).css("-webkit-touch-callout","none");a(b.backSelector).tap(w);a(b.submitSelector).tap(y);i=a("body");b.fullScreenClass&&window.navigator.standalone==true&&i.addClass(b.fullScreenClass+" "+b.statusBar);i.bind("touchstart",C).bind("orientationchange",x).trigger("orientationchange").submit(v);if(b.useFastTouch&&a.support.touch){i.click(function(c){var b=a(c.target);return b.attr("target")=="_blank"||b.attr("rel")=="external"||b.is('input[type="checkbox"]')?true:false});i.mousedown(function(){var a=(new Date).getTime()-q;if(a<200)return false})}if(a("body > .current").length==0)e=a("body > *:first");else{e=a("body > .current:first");a("body > .current").removeClass("current")}a(e).addClass("current");location.hash=a(e).attr("id");k(e);scrollTo(0,0);s()})}function n(b){if(d.length>1){var a=Math.min(parseInt(b||1,10),d.length-1);if(isNaN(a)&&typeof b==="string"&&b!="#")for(var c=1,g=d.length;c<g;c++)if("#"+d[c].id===b){a=c;break}if(isNaN(a)||a<1)a=1;var e=d[0].animation,f=d[0].page;d.splice(0,a);var i=d[0].page;l(f,i,e,true);return h}else{console.error("No pages in history.");return false}}function o(e,b){var g=d[0].page;if(typeof e==="string")e=a(e);if(typeof b==="string")for(var f=c.length-1;f>=0;f--)if(c[f].name===b){b=c[f];break}if(l(g,e,b)){k(e,b);return h}else{console.error("Could not animate pages.");return false}}function B(e,b){var g=d[0].page;if(typeof e==="string")e=a(e);if(typeof b==="string")for(var f=c.length-1;f>=0;f--)if(c[f].name===b){b=c[f];break}if(l(g,e,b,true)){k(e,b);return h}else{console.error("Could not animate pages.");return false}}function z(){return j}function w(i){var d=a(i.target);if(d.attr("nodeName")!=="A")d=d.parent("a");var h=d.attr("target"),e=d.attr("hash"),g=null;if(m==false||!d.length){console.warn("Not able to tap element.");return false}if(d.attr("target")=="_blank"||d.attr("rel")=="external")return true;for(var f=c.length-1;f>=0;f--)if(d.is(c[f].selector)){g=c[f];break}if(h=="_webapp")window.location=d.attr("href");else if(d.is(b.backSelector))n(e);else if(e&&e!="#"){d.addClass("active");o(a(e).data("referrer",d),g)}else{d.addClass("loading active");r(d.attr("href"),{animation:g,callback:function(){d.removeClass("loading");setTimeout(a.fn.unselect,250,d)},$referrer:d})}return false}function k(a,b){var c=a.attr("id");d.unshift({page:a,animation:b,id:c})}function l(f,c,d,g){if(c.length===0){a.fn.unselect();console.error("Target element is missing.");return false}a(":focus").blur();scrollTo(0,0);var h=function(){if(d){c.removeClass("in reverse "+d.name);f.removeClass("current out reverse "+d.name)}else f.removeClass("current");c.trigger("pageAnimationEnd",{direction:"in"});f.trigger("pageAnimationEnd",{direction:"out"});clearInterval(dumbLoop);e=c;location.hash=e.attr("id");s();var a=c.data("referrer");a&&a.unselect();q=(new Date).getTime();m=true};f.trigger("pageAnimationStart",{direction:"out"});c.trigger("pageAnimationStart",{direction:"in"});if(a.support.WebKitAnimationEvent&&d&&b.useAnimations){c.one("webkitAnimationEnd",h);m=false;c.addClass(d.name+" in current "+(g?" reverse":""));f.addClass(d.name+" out"+(g?" reverse":""))}else{c.addClass("current");h()}return true}function s(){dumbLoop=setInterval(function(){var a=e.attr("id");if(location.hash=="")location.hash="#"+a;else if(location.hash!="#"+a)try{n(location.hash)}catch(b){console.error("Unknown hash change.")}},100)}function D(d,c){var b=null;a(d).each(function(){var c=a(this);!c.attr("id")&&c.attr("id","page-"+ ++A);c.appendTo(i);if(c.hasClass("current")||!b)b=c});if(b!==null){o(b,c);return b}else return false}function r(d,f){var e={data:null,method:"GET",animation:null,callback:null,$referrer:null},c=a.extend({},e,f);if(d!="#")a.ajax({url:d,data:c.data,type:c.method,success:function(d){var a=D(d,c.animation);if(a){c.method=="GET"&&b.cacheGetRequests&&c.$referrer&&c.$referrer.attr("href","#"+a.attr("id"));c.callback&&c.callback(true)}},error:function(){c.$referrer&&c.$referrer.unselect();c.callback&&c.callback(false)}});else $referrer&&$referrer.unselect()}function v(e,f){var d=typeof e==="string"?a(e):a(e.target);if(d.length&&d.is(b.formSelector)&&d.attr("action")){r(d.attr("action"),{data:d.serialize(),method:d.attr("method")||"POST",animation:c[0]||null,callback:f});return false}return true}function y(){var b=a(this).closest("form");if(b.length){evt=jQuery.Event("submit");evt.preventDefault();b.trigger(evt);return false}return true}function t(b){if(typeof b.selector=="string"&&typeof b.name=="string"){c.push(b);a(b.selector).tap(w);g.push(b.selector)}}function x(){j=window.innerWidth<window.innerHeight?"profile":"landscape";i.removeClass("profile landscape").addClass(j).trigger("turn",{orientation:j})}function C(f){var b=a(f.target);if(!a(f.target).is(g.join(", "))){var j=a(f.target).closest("a");if(j.length)b=j;else return}if(event){var d=null,n=event.changedTouches[0].pageX,o=event.changedTouches[0].pageY,k=(new Date).getTime(),c=0,e=0,i=0;b.bind("touchmove",l).bind("touchend",m);d=setTimeout(function(){b.makeActive()},100)}function l(){h();var a=Math.abs(c),f=Math.abs(e);if(a>f&&a>35&&i<1e3)b.trigger("swipe",{direction:c<0?"left":"right"}).unbind("touchmove touchend");else f>1&&b.removeClass("active");clearTimeout(d)}function m(){h();if(e===0&&c===0){b.makeActive();b.trigger("tap")}else b.removeClass("active");b.unbind("touchmove touchend");clearTimeout(d)}function h(){var a=event.changedTouches[0]||null;c=a.pageX-n;e=a.pageY-o;i=(new Date).getTime()-k}}a.fn.unselect=function(b){if(b)b.removeClass("active");else a(".active").removeClass("active")};a.fn.makeActive=function(){return a(this).addClass("active")};a.fn.swipe=function(b){if(a.isFunction(b))return this.each(function(d,c){a(c).bind("swipe",b)})};a.fn.tap=function(c){if(a.isFunction(c)){var d=b.useFastTouch&&a.support.touch?"tap":"click";return a(this).live(d,c)}else a(this).trigger("tap")};h={getOrientation:z,goBack:n,goTo:o,addAnimation:t,submitForm:v,goToReverse:B};return h};a.jQTouch.prototype.extensions=[];a.jQTouch.addExtension=function(b){a.jQTouch.prototype.extensions.push(b)}})(jQuery);